<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>–ò–≥—Ä–∞üíñ</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

html, body {
    height: 100%;
    font-family: 'Inter', sans-serif;
    background:
        radial-gradient(circle at 20% 20%, #ffd9ea, transparent),
        radial-gradient(circle at 80% 80%, #ffeaf5, transparent),
        #fff7fb;
    width: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.iphone-container {
    width: 100%;
    min-height: 100vh;
    max-width: 390px;
    margin: 0 auto;
    position: relative;
}

.game-app {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
}

.game-card {
    position: relative;
    width: 100%;
    min-height: 800px;
    padding: 35px 25px 45px;
    border-radius: 32px;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    box-shadow: 
        0 40px 80px rgba(255, 80, 140, 0.15),
        inset 0 0 0 1px rgba(255, 255, 255, 0.8);
    animation: float 6s ease-in-out infinite;
    display: flex;
    flex-direction: column;
    margin-bottom: 40px;
}

@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
    100% { transform: translateY(0px); }
}

.game-header {
    text-align: center;
    margin-bottom: 30px;
    padding-top: 10px;
}

.game-header h1 {
    color: #ff2a78;
    font-size: 34px;
    font-weight: 800;
    margin-bottom: 12px;
    line-height: 1.2;
    text-shadow: 0 2px 10px rgba(255, 42, 120, 0.2);
}

.game-subtitle {
    color: #666;
    font-size: 16px;
    line-height: 1.4;
    max-width: 320px;
    margin: 0 auto;
    font-weight: 500;
}

.game-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    gap: 25px;
}

.heart-main {
    width: 200px;
    height: 200px;
    margin: 10px auto 20px;
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}

.heart-main svg {
    width: 100%;
    height: 100%;
    fill: #ff6fa5;
    filter: drop-shadow(0 15px 30px rgba(255, 111, 165, 0.5));
    transition: all 0.3s ease;
}

.heart-main:hover {
    transform: scale(1.08);
}

.heart-main:active svg {
    fill: #ff2a78;
    transform: scale(0.92);
}

.score-display {
    text-align: center;
    margin: 15px 0 20px;
}

.score-value {
    font-size: 72px;
    font-weight: 800;
    color: #ff2a78;
    line-height: 1;
    margin-bottom: 8px;
    text-shadow: 0 5px 15px rgba(255, 42, 120, 0.3);
}

.score-label {
    font-size: 18px;
    color: #888;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.progress-wrapper {
    width: 100%;
    max-width: 340px;
    margin: 20px auto;
}

.progress-container {
    background: rgba(255, 255, 255, 0.7);
    border-radius: 20px;
    height: 18px;
    overflow: hidden;
    position: relative;
    border: 2px solid rgba(255, 120, 170, 0.3);
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #ff8dbb, #ff2a78);
    border-radius: 20px;
    width: 0%;
    transition: width 0.5s ease;
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5);
}

.progress-text {
    display: flex;
    justify-content: space-between;
    margin-top: 12px;
    font-size: 15px;
    color: #666;
    font-weight: 500;
}

.challenges-container {
    width: 100%;
    margin: 30px 0;
}

.challenges-title {
    font-size: 22px;
    font-weight: 700;
    color: #ff2a78;
    margin-bottom: 20px;
    text-align: center;
    text-shadow: 0 2px 5px rgba(255, 42, 120, 0.1);
}

.challenges-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 18px;
}

.challenge-item {
    background: rgba(255, 255, 255, 0.8);
    padding: 22px 15px;
    border-radius: 22px;
    border: 2px solid rgba(255, 120, 170, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 120px;
}

.challenge-item.active {
    background: linear-gradient(135deg, rgba(255, 209, 230, 0.9), rgba(255, 230, 243, 0.9));
    border-color: #ff6fa5;
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(255, 111, 165, 0.25);
}

.challenge-item.completed {
    background: linear-gradient(135deg, rgba(209, 255, 214, 0.9), rgba(227, 255, 230, 0.9));
    border-color: #6fff7a;
}

.challenge-icon {
    font-size: 34px;
    margin-bottom: 15px;
    color: #ff6fa5;
}

.challenge-item.completed .challenge-icon {
    color: #4caf50;
}

.challenge-text {
    font-size: 15px;
    color: #555;
    font-weight: 600;
    text-align: center;
    line-height: 1.3;
}

.checkmark {
    position: absolute;
    top: 12px;
    right: 12px;
    color: #4caf50;
    font-size: 18px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.challenge-item.completed .checkmark {
    opacity: 1;
}

.buttons-row {
    display: flex;
    gap: 20px;
    margin-top: 35px;
    justify-content: center;
    width: 100%;
}

.action-btn {
    padding: 20px 32px;
    border: none;
    border-radius: 30px;
    font-size: 18px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex: 1;
    max-width: 180px;
    min-height: 68px;
    touch-action: manipulation;
}

.action-btn.primary {
    background: linear-gradient(135deg, #ff8dbb, #ff2a78);
    color: white;
    box-shadow: 0 15px 35px rgba(255, 42, 120, 0.35);
}

.action-btn.secondary {
    background: white;
    color: #ff2a78;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    border: 2px solid rgba(255, 120, 170, 0.3);
}

.action-btn.magic {
    background: linear-gradient(135deg, #c07cff, #9c5cff);
    color: white;
    box-shadow: 
        0 15px 35px rgba(156, 92, 255, 0.35),
        0 0 30px rgba(192, 124, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.action-btn.magic:hover {
    transform: translateY(-4px);
    box-shadow: 
        0 20px 40px rgba(156, 92, 255, 0.45),
        0 0 40px rgba(192, 124, 255, 0.4);
}

.action-btn.magic:active {
    transform: translateY(-1px);
}

.action-btn.magic::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.7s ease;
}

.action-btn.magic:hover::before {
    left: 100%;
}

.action-btn:hover {
    transform: translateY(-4px);
}

.action-btn:active {
    transform: translateY(-1px);
}

.victory-message {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 28px;
    padding: 35px 30px;
    margin: 30px 0;
    border: 3px solid #ffb8d9;
    display: none;
    animation: fadeInUp 0.8s ease;
    text-align: center;
    box-shadow: 0 20px 40px rgba(255, 120, 170, 0.2);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.victory-message.show {
    display: block;
}

.victory-title {
    color: #ff2a78;
    margin-bottom: 20px;
    font-size: 30px;
    font-weight: 800;
}

.victory-text {
    color: #555;
    line-height: 1.6;
    font-size: 18px;
    font-weight: 500;
}

.floating-hearts {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
}

.floating-heart {
    position: absolute;
    width: 24px;
    height: 24px;
    background: #ff9ac5;
    transform: rotate(45deg);
    animation: floatUp linear forwards;
    opacity: 0;
}

.floating-heart:before,
.floating-heart:after {
    content: '';
    position: absolute;
    width: 24px;
    height: 24px;
    background: #ff9ac5;
    border-radius: 50%;
}

.floating-heart:before { top: -12px; }
.floating-heart:after { left: -12px; }

@keyframes floatUp {
    0% {
        transform: translateY(100vh) rotate(45deg) scale(0.5);
        opacity: 0;
    }
    20% { opacity: 1; }
    100% {
        transform: translateY(-100px) rotate(45deg) scale(1.2);
        opacity: 0;
    }
}

.toast-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10000;
    animation: toastAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275),
               toastDisappear 0.5s ease 1.5s forwards;
    pointer-events: none;
    width: 85%;
    max-width: 320px;
}

.toast-content {
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-radius: 24px;
    padding: 22px 25px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 
        0 25px 50px rgba(255, 42, 120, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
    text-align: center;
}

.toast-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.4) 0%, 
        rgba(255, 255, 255, 0.1) 100%);
    border-radius: 24px;
    z-index: -1;
}

.toast-content::after {
    content: '';
    position: absolute;
    top: 1px;
    left: 1px;
    right: 1px;
    bottom: 1px;
    background: radial-gradient(
        100% 100% at 50% 0%,
        rgba(255, 255, 255, 0.8) 0%,
        rgba(255, 255, 255, 0.6) 50%,
        rgba(255, 255, 255, 0.4) 100%
    );
    border-radius: 23px;
    z-index: -2;
}

.toast-icon {
    font-size: 42px;
    margin-bottom: 15px;
    display: block;
    color: #ff2a78;
    filter: drop-shadow(0 5px 15px rgba(255, 42, 120, 0.3));
}

.toast-text {
    color: #333;
    font-size: 17px;
    font-weight: 600;
    line-height: 1.4;
    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
    margin: 0;
}

@keyframes toastAppear {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.7);
    }
    70% {
        transform: translate(-50%, -50%) scale(1.05);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

@keyframes toastDisappear {
    0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
}

.toast-success .toast-content {
    background: rgba(76, 255, 130, 0.15);
    border-color: rgba(76, 255, 130, 0.4);
    box-shadow: 
        0 25px 50px rgba(76, 255, 130, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
}

.toast-success .toast-icon {
    color: #4cff82;
}

.toast-hint .toast-content {
    background: rgba(156, 92, 255, 0.15);
    border-color: rgba(156, 92, 255, 0.4);
    box-shadow: 
        0 25px 50px rgba(156, 92, 255, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
}

.toast-hint .toast-icon {
    color: #9c5cff;
}

.toast-love .toast-content {
    background: rgba(255, 42, 120, 0.15);
    border-color: rgba(255, 42, 120, 0.4);
    box-shadow: 
        0 25px 50px rgba(255, 42, 120, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
}

.toast-love .toast-icon {
    color: #ff2a78;
}

@media (max-height: 750px) {
    .game-card {
        min-height: 750px;
        padding: 30px 20px 40px;
    }
    
    .heart-main {
        width: 180px;
        height: 180px;
    }
    
    .score-value {
        font-size: 64px;
    }
    
    .challenges-grid {
        gap: 15px;
    }
    
    .challenge-item {
        min-height: 110px;
        padding: 20px 12px;
    }
    
    .action-btn {
        padding: 18px 28px;
        min-height: 62px;
    }
}

@supports (padding: max(0px)) {
    .game-app {
        padding: max(20px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) 
                 max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-left));
    }
}

@media (max-width: 480px) {
    .game-header h1 {
        font-size: 30px;
    }
    
    .score-value {
        font-size: 64px;
    }
    
    .heart-main {
        width: 180px;
        height: 180px;
    }
    
    .action-btn {
        max-width: 170px;
    }
    
    .toast-notification {
        width: 90%;
    }
    
    .toast-content {
        padding: 20px 22px;
    }
    
    .toast-text {
        font-size: 16px;
    }
}
</style>
</head>

<body>
<div class="iphone-container">
    <div class="game-app">
        <div class="game-card">
            <div class="game-header">
                <h1>–°–µ—Ä–¥–µ—á–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è üíï</h1>
                <p class="game-subtitle">–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ —Å–æ–±–∏—Ä–∞–π —Å–µ—Ä–¥–µ—á–∫–∏! –¶–µ–ª—å: 50 –æ—á–∫–æ–≤</p>
            </div>
            
            <div class="game-area">
                <div class="heart-main" id="heartClick">
                    <svg viewBox="0 0 32 29.6">
                        <path d="M23.6,0c-3.4,0-6.3,2.7-7.6,5.6C14.7,2.7,11.8,0,8.4,0C3.8,0,0,3.8,0,8.4c0,9.4,9.5,11.9,16,21.2
                        c6.1-9.3,16-12.1,16-21.2C32,3.8,28.2,0,23.6,0z"/>
                    </svg>
                </div>
                
                <div class="score-display">
                    <div class="score-value" id="scoreValue">0</div>
                    <div class="score-label">—Å–æ–±—Ä–∞–Ω–æ –æ—á–∫–æ–≤</div>
                </div>
                
                <div class="progress-wrapper">
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text">
                        <span>0</span>
                        <span id="progressPercent">0%</span>
                        <span>50</span>
                    </div>
                </div>
                
                <div class="challenges-container">
                    <div class="challenges-title">–ó–∞–¥–∞–Ω–∏—è:</div>
                    <div class="challenges-grid">
                        <div class="challenge-item" id="challenge1">
                            <div class="challenge-icon">üëÜ</div>
                            <div class="challenge-text">10 –±—ã—Å—Ç—Ä—ã—Ö –∫–ª–∏–∫–æ–≤</div>
                            <div class="checkmark">‚úì</div>
                        </div>
                        <div class="challenge-item" id="challenge2">
                            <div class="challenge-icon">‚è±Ô∏è</div>
                            <div class="challenge-text">–î–µ—Ä–∂–∏ 3 —Å–µ–∫—É–Ω–¥—ã</div>
                            <div class="checkmark">‚úì</div>
                        </div>
                        <div class="challenge-item" id="challenge3">
                            <div class="challenge-icon">üéØ</div>
                            <div class="challenge-text">5 —Ç–æ—á–Ω—ã—Ö —Ç–∞–ø–æ–≤</div>
                            <div class="checkmark">‚úì</div>
                        </div>
                        <div class="challenge-item" id="challenge4">
                            <div class="challenge-icon">üí´</div>
                            <div class="challenge-text">–°–æ–±–µ—Ä–∏ 50 –æ—á–∫–æ–≤</div>
                            <div class="checkmark">‚úì</div>
                        </div>
                    </div>
                </div>
                
                <div class="victory-message" id="victoryMessage">
                    <h3 class="victory-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! üéâ</h3>
                    <p class="victory-text">–¢—ã —Å–æ–±—Ä–∞–ª–∞ –≤—Å–µ —Å–µ—Ä–¥–µ—á–∫–∏! –í–∏–¥–∏–º–æ, —Ç–≤–æ—ë —Å–µ—Ä–¥—Ü–µ —Ç–æ–∂–µ –≥–æ—Ç–æ–≤–æ –∫ —á–µ–º—É-—Ç–æ –±–æ–ª—å—à–µ–º—É... –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø—Ä–æ—à–ª–∞ —ç—Ç—É –∏–≥—Ä—É –¥–æ –∫–æ–Ω—Ü–∞! –¢—ã ‚Äî —Å–∞–º–∞—è –º–∏–ª–∞—è üíñ</p>
                </div>
            </div>
            
            <div class="buttons-row">
                <button class="action-btn primary" id="resetBtn">
                    <i class="fas fa-redo"></i> –ó–∞–Ω–æ–≤–æ
                </button>
                <button class="action-btn secondary" id="hintBtn">
                    <i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞
                </button>
            </div>
        </div>
        
        <div class="floating-hearts" id="floatingHearts"></div>
    </div>
</div>

<script>
    let score = 0;
    let totalClicks = 0;
    let holdStartTime = 0;
    let isHolding = false;
    let holdTimer = null;
    let isGameCompleted = false;
    
    const challenges = {
        quickClicks: { current: 0, target: 10, completed: false },
        holdTime: { current: 0, target: 3, completed: false },
        preciseTaps: { current: 0, target: 5, completed: false },
        totalScore: { current: 0, target: 50, completed: false }
    };
    
    const elements = {
        scoreValue: document.getElementById('scoreValue'),
        progressBar: document.getElementById('progressBar'),
        progressPercent: document.getElementById('progressPercent'),
        heartClick: document.getElementById('heartClick'),
        victoryMessage: document.getElementById('victoryMessage'),
        resetBtn: document.getElementById('resetBtn'),
        hintBtn: document.getElementById('hintBtn')
    };
    
    const challengeElements = {
        1: document.getElementById('challenge1'),
        2: document.getElementById('challenge2'),
        3: document.getElementById('challenge3'),
        4: document.getElementById('challenge4')
    };
    
    const backgroundMusic = new Audio();
    backgroundMusic.src = "music.mp3"; 
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.3;
    backgroundMusic.preload = "auto";
    
    function startBackgroundMusic() {
        document.addEventListener('click', function startMusicOnce() {
            if (backgroundMusic.paused) {
                backgroundMusic.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ"));
            }
            document.removeEventListener('click', startMusicOnce);
        }, { once: true });
    }
    
    startBackgroundMusic();
    
    updateDisplay();
    
    function handleTap(e) {
        if (isGameCompleted) return;
        
        e.preventDefault();
        e.stopPropagation();
        
        totalClicks++;
        score += 1;
        
        const heart = elements.heartClick;
        heart.style.transform = 'scale(0.92)';
        setTimeout(() => {
            heart.style.transform = 'scale(1.08)';
        }, 100);
        setTimeout(() => {
            heart.style.transform = 'scale(1)';
        }, 200);
        
        challenges.quickClicks.current++;
        if (!challenges.quickClicks.completed && challenges.quickClicks.current >= challenges.quickClicks.target) {
            completeChallenge(1);
        }
        
        if (!challenges.preciseTaps.completed && Math.random() > 0.7) {
            challenges.preciseTaps.current++;
            if (challenges.preciseTaps.current >= challenges.preciseTaps.target) {
                completeChallenge(3);
            }
        }
        
        if (!challenges.totalScore.completed && score >= 50) {
            completeChallenge(4);
        }
        
        updateDisplay();
        createFloatingHeart();
        
        if (navigator.vibrate) {
            navigator.vibrate(10);
        }
        
        if (backgroundMusic.paused) {
            backgroundMusic.play().catch(e => console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É"));
        }
    }
    
    function startHold(e) {
        if (isGameCompleted) return;
        
        e.preventDefault();
        e.stopPropagation();
        
        if (isHolding) return;
        
        isHolding = true;
        holdStartTime = Date.now();
        elements.heartClick.style.transform = 'scale(0.85)';
        
        if (!challenges.holdTime.completed) {
            challengeElements[2].classList.add('active');
        }
        
        holdTimer = setTimeout(() => {
            if (isHolding) {
                score += 5;
                challenges.holdTime.current = 3;
                if (!challenges.holdTime.completed) {
                    completeChallenge(2);
                }
                
                createHeartBurst();
                updateDisplay();
                
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 100]);
                }
            }
        }, 3000);
    }
    
    function endHold() {
        if (!isHolding) return;
        
        isHolding = false;
        if (holdTimer) clearTimeout(holdTimer);
        
        elements.heartClick.style.transform = 'scale(1.08)';
        setTimeout(() => {
            elements.heartClick.style.transform = 'scale(1)';
        }, 300);
        
        challengeElements[2].classList.remove('active');
        
        if (holdStartTime > 0) {
            const holdDuration = (Date.now() - holdStartTime) / 1000;
            challenges.holdTime.current = Math.max(challenges.holdTime.current, holdDuration);
            holdStartTime = 0;
        }
    }
    
    elements.heartClick.addEventListener('click', handleTap);
    elements.heartClick.addEventListener('touchstart', function(e) {
        handleTap(e);
        startHold(e);
    }, { passive: false });
    
    elements.heartClick.addEventListener('touchend', endHold);
    elements.heartClick.addEventListener('touchcancel', endHold);
    
    elements.heartClick.addEventListener('mousedown', startHold);
    elements.heartClick.addEventListener('mouseup', endHold);
    elements.heartClick.addEventListener('mouseleave', endHold);
    
    elements.resetBtn.addEventListener('click', resetGame);
    elements.hintBtn.addEventListener('click', showHint);
    
    function showBeautifulToast(message, type = 'love') {
        const icons = {
            'love': 'üíñ',
            'success': 'üéâ',
            'hint': 'üí°',
            'star': '‚≠ê'
        };
        
        const toast = document.createElement('div');
        toast.className = `toast-notification toast-${type}`;
        toast.innerHTML = `
            <div class="toast-content">
                <span class="toast-icon">${icons[type] || 'üíñ'}</span>
                <p class="toast-text">${message}</p>
            </div>
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            if (toast.parentNode) {
                toast.remove();
            }
        }, 2000);
        
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    function updateDisplay() {
        challenges.totalScore.current = score;
        elements.scoreValue.textContent = score;
        
        const progress = Math.min((score / 50) * 100, 100);
        elements.progressBar.style.width = progress + '%';
        elements.progressPercent.textContent = Math.round(progress) + '%';
        
        if (score >= 50 && !challenges.totalScore.completed) {
            completeChallenge(4);
        }
        
        const allChallengesCompleted = 
            challenges.quickClicks.completed &&
            challenges.holdTime.completed &&
            challenges.preciseTaps.completed &&
            challenges.totalScore.completed;
        
        if (allChallengesCompleted && !isGameCompleted) {
            isGameCompleted = true;
            setTimeout(showFinalMessage, 500);
        }
    }
    
    function completeChallenge(challengeId) {
        const challenge = challengeElements[challengeId];
        if (challenge && !challenge.classList.contains('completed')) {
            challenge.classList.add('completed');
            
            switch(challengeId) {
                case 1: challenges.quickClicks.completed = true; break;
                case 2: challenges.holdTime.completed = true; break;
                case 3: challenges.preciseTaps.completed = true; break;
                case 4: challenges.totalScore.completed = true; break;
            }
            
            if (challengeId !== 4) {
                score += 10;
            }
            
            createHeartBurst();
            
            const messages = {
                1: "–ü–µ—Ä–≤–æ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü! üí™",
                2: "–£–¥–µ—Ä–∂–∞–ª–∞! –ó–Ω–∞—á–∏—Ç, —Ç—ã —É–º–µ–µ—à—å –±—ã—Ç—å —Ç–µ—Ä–ø–µ–ª–∏–≤–æ–π üòâ",
                3: "–ò–¥–µ–∞–ª—å–Ω—ã–µ –ø–æ–ø–∞–¥–∞–Ω–∏—è! –¢—ã —Ç–æ—á–Ω–æ –≤ —Ü–µ–ª—å üéØ",
                4: "üéâ 50 –æ—á–∫–æ–≤ —Å–æ–±—Ä–∞–Ω–æ!"
            };
            
            showBeautifulToast(messages[challengeId], challengeId === 4 ? 'success' : 'love');
            
            updateDisplay();
        }
    }
    
    function showFinalMessage() {
        createHeartBurst();
        setTimeout(createHeartBurst, 300);
        setTimeout(createHeartBurst, 600);
        
        createConfetti();
        
        setTimeout(() => {
            elements.victoryMessage.classList.add('show');
            
            elements.victoryMessage.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100, 50, 200]);
            }
            
            elements.resetBtn.innerHTML = '<i class="fas fa-heart"></i> –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞';
            elements.resetBtn.style.background = 'linear-gradient(135deg, #ff2a78, #ff0080)';
            
            const continueBtn = document.createElement('button');
            continueBtn.className = 'action-btn magic';
            continueBtn.innerHTML = '<i class="fas fa-star"></i> –ß—Ç–æ –¥–∞–ª—å—à–µ?';
            continueBtn.style.marginTop = '20px';
            continueBtn.onclick = function() {
                showFinalSurprise();
            };
            
            elements.victoryMessage.appendChild(continueBtn);
            
        }, 1000);
    }
    
    function showFinalSurprise() {
        const finalMessage = `
            <div style="text-align: center; padding: 30px;">
                <h3 style="color: #ff2a78; font-size: 32px; margin-bottom: 20px;">–ê –¥–∞–ª—å—à–µ ‚Äî —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å ‚ú®</h3>
                <p style="font-size: 18px; line-height: 1.6; color: #555; margin-bottom: 25px;">
                    –≠—Ç–∞ –∏–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –Ω–æ –Ω–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è.<br>
                    –ö–∞–∂–¥–æ–µ —Ç–≤–æ—ë –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ –∫ —ç–∫—Ä–∞–Ω—É ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç–æ–º,<br>
                    –∫–∞–∫ —Å–∏–ª—å–Ω–æ —è —Ö–æ—á—É –ø—Ä–∏–∫–æ—Å–Ω—É—Ç—å—Å—è –∫ —Ç–µ–±–µ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É.
                </p>
                <div style="background: rgba(255, 42, 120, 0.1); padding: 20px; border-radius: 20px; margin: 25px 0;">
                    <p style="font-size: 20px; color: #ff2a78; font-weight: bold;">
                        –õ—é–±–ª—é —Ç–µ–±—è
                    </p>
                </div> 
                <p style="font-size: 16px; color: #888; margin-top: 30px;">
                    –ù–∞–¥–µ—é—Å—å, —ç—Ç–∞ –∏–≥—Ä–∞ –∑–∞—Å—Ç–∞–≤–∏–ª–∞ —Ç–µ–±—è —É–ª—ã–±–Ω—É—Ç—å—Å—è<br>
                    –•–æ—Ç—è –±—ã —Ç–∞–∫ –∂–µ, –∫–∞–∫ —Ç—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ—à—å —É–ª—ã–±–∞—Ç—å—Å—è –º–µ–Ω—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üíï
                </p>
            </div>
        `;
        
        elements.victoryMessage.innerHTML = finalMessage;
        
        createConfetti();
        setTimeout(createConfetti, 500);
        setTimeout(createConfetti, 1000);
        
        setTimeout(() => {
            showBeautifulToast("–¢—ã —Å–∞–º–∞—è –ª—É—á—à–∞—è! üíñ", 'love');
        }, 500);
    }
    
    function showTemporaryMessage(text) {
        showBeautifulToast(text, 'love');
    }
    
    function createFloatingHeart() {
        const heart = document.createElement('div');
        heart.className = 'floating-heart';
        
        const heartRect = elements.heartClick.getBoundingClientRect();
        const x = heartRect.left + heartRect.width / 2 + (Math.random() - 0.5) * 100;
        const y = heartRect.top + heartRect.height / 2;
        
        heart.style.left = x + 'px';
        heart.style.top = y + 'px';
        heart.style.animationDuration = (2 + Math.random() * 3) + 's';
        
        const hue = 330 + Math.random() * 30;
        heart.style.background = `hsl(${hue}, 100%, 70%)`;
        
        document.getElementById('floatingHearts').appendChild(heart);
        setTimeout(() => {
            if (heart.parentNode) {
                heart.remove();
            }
        }, 5000);
    }
    
    function createHeartBurst() {
        for (let i = 0; i < 6; i++) {
            setTimeout(() => {
                createFloatingHeart();
            }, i * 100);
        }
    }
    
    function createConfetti() {
        const colors = ['#ff6fa5', '#ff8dbb', '#ff2a78', '#ffb8d9', '#ff5c9d', '#c07cff', '#9c5cff'];
        
        for (let i = 0; i < 30; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-20px';
                confetti.style.animation = `confettiFall ${1 + Math.random() * 2}s ease-out forwards`;
                confetti.style.zIndex = '1000';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                setTimeout(() => {
                    if (confetti.parentNode) {
                        document.body.removeChild(confetti);
                    }
                }, 3000);
            }, i * 40);
        }
        
        if (!document.querySelector('#confetti-style')) {
            const style = document.createElement('style');
            style.id = 'confetti-style';
            style.textContent = `
                @keyframes confettiFall {
                    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                    100% { transform: translateY(400px) rotate(360deg); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
    }
    
    function resetGame() {
        score = 0;
        totalClicks = 0;
        isGameCompleted = false;
        
        challenges.quickClicks = { current: 0, target: 10, completed: false };
        challenges.holdTime = { current: 0, target: 3, completed: false };
        challenges.preciseTaps = { current: 0, target: 5, completed: false };
        challenges.totalScore = { current: 0, target: 50, completed: false };
        
        Object.values(challengeElements).forEach(el => {
            el.classList.remove('completed', 'active');
        });
        
        elements.victoryMessage.classList.remove('show');
        
        elements.resetBtn.innerHTML = '<i class="fas fa-redo"></i> –ó–∞–Ω–æ–≤–æ';
        elements.resetBtn.style.background = 'linear-gradient(135deg, #ff8dbb, #ff2a78)';
        
        updateDisplay();
        
        if (navigator.vibrate) {
            navigator.vibrate(50);
        }
    }
    
    function showHint() {
        const hints = [
            "–í—ã–ø–æ–ª–Ω–∏ –≤—Å–µ 4 –∑–∞–¥–∞–Ω–∏—è (–∂–º–∏ –Ω–∞ ‚ù§Ô∏è)",
            "–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –æ–±–≤–µ–¥–µ–Ω—ã –∑–µ–ª–µ–Ω—ã–º"
        ];
        
        const hint = hints[Math.floor(Math.random() * hints.length)];
        showBeautifulToast(hint, 'hint');
        
        if (navigator.vibrate) {
            navigator.vibrate(30);
        }
    }
    
    setInterval(() => {
        if (Math.random() > 0.6 && !isGameCompleted) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = (3 + Math.random() * 4) + 's';
            
            const hue = 330 + Math.random() * 30;
            heart.style.background = `hsl(${hue}, 100%, 70%)`;
            
            document.getElementById('floatingHearts').appendChild(heart);
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.remove();
                }
            }, 7000);
        }
    }, 1500);
    
    document.addEventListener('touchmove', function(e) {
        if(e.scale !== 1) {
            e.preventDefault();
        }
    }, { passive: false });
    
    setTimeout(() => {
        for (let i = 0; i < 5; i++) {
            setTimeout(() => {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = (3 + Math.random() * 3) + 's';
                heart.style.background = `hsl(${330 + Math.random() * 30}, 100%, 70%)`;
                
                document.getElementById('floatingHearts').appendChild(heart);
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.remove();
                    }
                }, 6000);
            }, i * 400);
        }
    }, 500);
    
    document.addEventListener('DOMContentLoaded', function() {
        document.body.style.touchAction = 'manipulation';
        
        elements.heartClick.addEventListener('touchstart', function() {
            this.classList.add('tapping');
        }); 
        
        elements.heartClick.addEventListener('touchend', function() {
            this.classList.remove('tapping');
        });
        
        const tapStyle = document.createElement('style');
        tapStyle.textContent = `
            .heart-main.tapping {
                transform: scale(0.95) !important;
                opacity: 0.9;
                transition: transform 0.1s ease, opacity 0.1s ease;
            }
        `;
        document.head.appendChild(tapStyle);
    });
</script>
</body>
</html>